<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Page</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        table {
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        .back-arrow {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            cursor: pointer;
            text-decoration: none;
            color: black;
        }
        .column-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .column-controls button {
            font-size: 16px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <a href="#" class="back-arrow" onclick="goBack()">&#8592; Zurück</a>
    <h2 id="pageTitle"></h2>
    
    <div class="column-controls">
        <div>
            <button onclick="removeColumn('K')">-</button>
            <span>KA</span>
            <button onclick="addColumn('K')">+</button>
        </div>
        <div>
            <button onclick="removeColumn('T')">-</button>
            <span>Test</span>
            <button onclick="addColumn('T')">+</button>
        </div>
        <div>
            <button onclick="removeColumn('H')">-</button>
            <span>Heft</span>
            <button onclick="addColumn('H')">+</button>
        </div>
        <div>
            <button onclick="removeColumn('M')">-</button>
            <span>Mündl.</span>
            <button onclick="addColumn('M')">+</button>
        </div>
    </div>
    
    <table id="itemTable">
        <tr>
            <th></th>
            <th>Schüler</th>
            <th>Schnitt</th>
            
        </tr>
    </table>

    <button onclick="showInputField()">Neuen Schüler hinzufügen</button>
    <div id="inputContainer" style="display: none; margin-top: 10px;">
        <input type="text" id="detailField" placeholder="Enter detail">
        <button onclick="addDetail()">-></button>
    </div>

    <script>
        function getQueryParam(param) {
            let urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        let itemName = getQueryParam('data');
        document.getElementById('pageTitle').textContent = `Noten in  ${itemName}`;

        function showInputField() {
            document.getElementById('inputContainer').style.display = 'block';
        }

        function addDetail() {
            let table = document.getElementById('itemTable');
            let detailInput = document.getElementById('detailField');
            let detailValue = detailInput.value;
            if (!detailValue) return;

            let rows = Array.from(table.rows).slice(1);
            let newRow = document.createElement('tr');
            let detailCell = document.createElement('td');
            detailCell.textContent = detailValue;
            newRow.appendChild(detailCell);

            for (let i = 1; i < table.rows[0].cells.length - 1; i++) {
                newRow.appendChild(document.createElement('td'));
            }

            let deleteCell = document.createElement('td');
            let deleteButton = document.createElement("button");
            deleteButton.textContent = "Delete";
            deleteButton.onclick = function() { table.deleteRow(newRow.rowIndex); };
            deleteCell.appendChild(deleteButton);
            newRow.appendChild(deleteCell);

            rows.push(newRow);
            rows.sort((a, b) => a.cells[0].textContent.localeCompare(b.cells[0].textContent));

            table.innerHTML = "<tr><th>Details</th><th>Actions</th></tr>";
            rows.forEach(row => table.appendChild(row));
            
            detailInput.value = "";
        }

        function loadTableData() {
            let data = JSON.parse(localStorage.getItem(`tableData_${itemName}`)) || [];
            let table = document.getElementById('itemTable');
            data.forEach(value => {
                let row = table.insertRow(-1);
                let cell = row.insertCell(row.cells.length - 1);
                cell.textContent = value;

                let deleteCell = row.insertCell(row.cells.length);
                let deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.onclick = function () { deleteDetail(row, value); };
                deleteCell.appendChild(deleteBtn);
            });
        }

        function deleteDetail(row, value) {
            let table = document.getElementById('itemTable');
            table.deleteRow(row.rowIndex);
            let data = JSON.parse(localStorage.getItem(`tableData_${itemName}`)) || [];
            let updatedData = data.filter(item => item !== value);
            localStorage.setItem(`tableData_${itemName}`, JSON.stringify(updatedData));
        }

        function addColumn(letter) {
            let table = document.getElementById('itemTable');
            let rows = table.rows;
            let columnIndex = -1;
            
            for (let i = 1; i < rows[0].cells.length - 1; i++) {
                if (rows[0].cells[i].textContent === letter) {
                    columnIndex = i + 1;
                }
            }
            
            for (let i = 0; i < rows.length; i++) {
                let cell = rows[i].insertCell(columnIndex === -1 ? rows[i].cells.length - 1 : columnIndex);
                cell.textContent = i === 0 ? letter : "";
            }
        }

        function removeColumn(letter) {
            let table = document.getElementById('itemTable');
            let rows = table.rows;
            let columnIndex = -1;
            
            for (let i = 1; i < rows[0].cells.length - 1; i++) {
                if (rows[0].cells[i].textContent === letter) {
                    columnIndex = i;
                    break;
                }
            }
            
            if (columnIndex !== -1) {
                for (let i = 0; i < rows.length; i++) {
                    rows[i].deleteCell(columnIndex);
                }
            }
        }

        function goBack() {
            let previousPage = localStorage.getItem("previousPage");
            if (previousPage) {
                window.location.href = previousPage;
            } else {
                window.location.href = "klasse.html";
            }
        }

        document.addEventListener("DOMContentLoaded", loadTableData);
    </script>
</body>
</html>